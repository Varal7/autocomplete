{% load staticfiles %}
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="An autocomplete service" />
    <title>Autocomplete.bin</title>
    <!-- Bootstrap -->
    <link href="{% static "css/bootstrap.min.css" %}" rel="stylesheet">
    <link href="{% static "css/custom.css" %}" rel="stylesheet">
  </head>
  <body>
      <div id="app" class="container">
          <h1>Autocomplete.bin</h1>
          {% if request.user.is_authenticated %}
              <div class="pull-right">
                  <span class="label label-success">Authentificated as {{ request.user }}</span>
                  <a class="btn btn-default" href="{% url 'cas_ng_logout' %}">Logout</a>
              </div>
          {% else %}
              <span class="label label-primary pull-right">On-platal IP: {{ request.META.REMOTE_ADDR }}</span>
          {% endif %}
          <br /> <br />
          <div class="row" v-if="people.length">
              <div class="col-md-6">
                  <div class="panel panel-primary">
                      <div class="panel-heading">
                          Choose what field to export
                      </div>
                      <div class="panel-body">
                          <!--TODO: Use  http://rubaxa.github.io/Sortable/ -->
                          <div class="checkbox"><label><input type="checkbox" value="firstname" v-model="choices.firstname">First name</label></div>
                          <div class="checkbox"><label><input type="checkbox" value="lastname" v-model="choices.lastname">Last name</label></div>
                          <div class="checkbox"><label><input type="checkbox" value="mail" v-model="choices.mail">Email</label></div>
                          <div class="checkbox"><label><input type="checkbox" value="promo" v-model="choices.promo">Promo</label></div>
                          <div class="checkbox"><label><input type="checkbox" value="phone" v-model="choices.phone">Phone</label></div>
                          <div class="checkbox"><label><input type="checkbox" value="room" v-model="choices.room">Room</label></div>
                      </div>
                  </div>
              </div>
              <div class="col-md-6">
                  <person :person="current"></person>
              </div>
          </div>
          <div class="panel panel-primary">
              <div class="panel-heading">
                  Search
              </div>
              <typeahead placeholder="Search by firstname.lastname" async-key="users" :limit=20 async="ldap_search?q=" template-name="ldap-template" :template="ldapTemplate" :on-hit="ldapCallback"></typeahead>
          </div>
          <br />
          <results-table :people="people" :choices="choices" v-on:delete_item="delete_item" v-on:clear="clear"></results-table>
          <br />
          <results :people="people" :choices="choices"></results>
      </div>

      {%  verbatim %}
      <template id="person">
          <div v-if="person" class="panel panel-primary person">
              <div class="panel-heading">
                  Preview last person
              </div>
              <div class="panel-body">
                  <div class="row">
                      <div class="img-container col-md-3">
                          <img height="100px" :src="person.photo">
                      </div>
                      <div class="col-md-9">
                          <p>
                              <strong>First name :</strong> {{ person.firstname  }}<br/>
                              <strong>Last name :</strong> {{ person.lastname  }}<br/>
                              <strong>Promo :</strong> {{ person.promo }}<br/>
                              <strong>Room :</strong> {{ person.room  }}<br/>
                              <strong>Email :</strong> <a :href="'mailto:' + person.mail">{{ person.mail }}</a><br/>
                              <strong>Phone :</strong> <a :href="'tel:' + person.phone">{{ person.phone }}</a><br/>
                              <strong>uid :</strong> {{ person.uid  }}
                          </p>
                      </div>
                  </div>
              </div>
          </div>
      </template>

      <template id="results-table">
          <div class="panel panel-primary" v-if="people.length">
              <div class="panel-heading">
                 Results
              </div>
              <table class="table table-hover">
                  <tr>
                      <th>uid</th>
                      <th v-if="choices.firstname">First name</th>
                      <th v-if="choices.lastname">Last name</th>
                      <th v-if="choices.mail">Email</th>
                      <th v-if="choices.promo">Promo</th>
                      <th v-if="choices.phone">Phone</th>
                      <th v-if="choices.room">Room</th>
                      <th class="text-center"><a class="btn btn-danger btn-xs" v-on:click="clear">Delete all</a></th>
                  </tr>
                  <tr v-for="(person, index) in people">
                      <td>{{ person.uid }}</td>
                      <td v-if="choices.firstname">{{ person.firstname }}</td>
                      <td v-if="choices.lastname">{{ person.lastname }}</td>
                      <td v-if="choices.mail">{{ person.mail }}</td>
                      <td v-if="choices.promo">{{ person.promo }}</td>
                      <td v-if="choices.phone">{{ person.phone }}</td>
                      <td v-if="choices.room">{{ person.room }}</td>
                      <td class="text-center"><a class="btn btn-warning btn-xs" v-on:click="delete_item(index)"><i class="glyphicon glyphicon-remove"></i></a></td>
                  </tr>
              </table>
          </div>

      </template>

      <template id="results">
          <div v-if="output">
              <textarea readonly class="form-control" rows="5">{{ output }}</textarea><br />
              <button v-on:click="export_csv" class="pull-right btn btn-success">Export as CSV</button>
          </div>
      </template>
  {% endverbatim %}
    <script src="{% static "js/lib/vue.js" %}"></script>
    <script src="{% static "js/lib/vue-strap.js" %}"></script>
    <script src="{% static "js/app.js" %}"></script>
  </body>
</html>
